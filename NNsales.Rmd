---
title: "neualNetSales"
author: "Dr. J"
date: "7/21/2019"
output: 
  html_document:
    toc: true
    number_sections: true
    theme: united
---

# Introduction
This is an example application of a neural network designed to identify characterists of car buyers.  This could potentially aid in advertising

## first set up the environment
Assumes the .csv file 'cars.csv' is in the working directory  

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(neuralnet)
cars = read.csv('cars.csv', header=TRUE)
#normalize age, miles, debt, income, and sales
carsNormalized = cars
carsNormalized$age = (cars$age-mean(cars$age))/sd(cars$age)
carsNormalized$miles = (cars$miles-mean(cars$miles))/sd(cars$miles)
carsNormalized$debt = (cars$debt - mean(cars$debt))/sd(cars$debt)
carsNormalized$income = (cars$income-mean(cars$income))/sd(cars$income)
carsNormalized$sales = (cars$sales-mean(cars$sales))/sd(cars$sales)


```

## print the first 6 entries of the cars data set

```{r}
head(cars)

summary(cars$sales)
hist(cars$sales, xlab='price')

# set up 'yes / no' based on sales price $10k
cars$salesTgt = ifelse(cars$sales>10000,1,0)

head(cars)
```

# Set up the neural net

```{r}
##set up the training and test data:
lengthData = length(cars$age) #  how many entries in the data set
nTrain = 0
nTest=0
nTrain = round(0.80*lengthData,0)
nTest = lengthData-nTrain

# shuffle the data, take the first nTrain as the training set, the 
# remainder as the test set
shuffle = sample(1:lengthData) 

#trainDataSet = carsNormalized[shuffle[1:nTrain],]
#testDataSet = carsNormalized[shuffle[(nTrain+1) : lengthData],]
testDataSet = vector("numeric", length=nTest)
trainDataset= vector("numeric", length=nTrain)
trainIndex = shuffle[1:nTrain]
trainDataSet = cars[shuffle[1:nTrain],]

testIndex = vector("numeric")
testIndex = shuffle[nTest+1:lengthData]
testDataSet = cars[shuffle[(nTrain+1):lengthData],]

head(trainDataSet)

```

## what factors may be in play??
```{r}
linearModel = lm(sales~.^2, data = trainDataSet)
summary(linearModel)
```




```{r}

salesNet = neuralnet(salesTgt~age+miles+debt+income, data = trainDataSet, hidden=c(1), stepmax=1.e5, rep=5)

plot(salesNet)
```


## look at a few of the fit values..

```{r}
randomTest = sample(seq((nTrain+1):lengthData),5)
randomTest=seq(1,9)
x = data.frame(age=trainDataSet$age[randomTest],                  miles=trainDataSet$miles[randomTest],
    debt= trainDataSet$debt[randomTest], 
    income= trainDataSet$income[randomTest])
print(x)
predictSales = predict(salesNet,x )
print(paste('actual = ',trainDataSet$sales[randomTest],'  predicted: ',predictSales[1:9] ))


```

## normalized..

```{r}
testDataSetNormalized = vector("numeric", length=nTest)
trainDatasetNormalezed= vector("numeric", length=nTrain)
#trainIndex = shuffle[1:nTrain]
#trainDataSet = cars[shuffle[1:nTrain],]

#testIndex = vector("numeric")
#testIndex = shuffle[nTest+1:lengthData]

trainDataSetNormalized= carsNormalized[shuffle[1:nTrain],]

testDataSetNormalized = carsNormalized[shuffle[(nTrain+1):lengthData],]

head(trainDataSetNormalized)
```



```{r}
salesNetNormalized = neuralnet(sales~age+miles+debt+income, data = trainDataSetNormalized, hidden=c(1), stepmax=1.e5, rep=5)

#learningrate.factor = list(minus = 0.5,plus = 1.8))
plot(salesNet)
```



## how'd we do on the normalized test set?

```{r}
predictTestNormalized = predict(salesNetNormalized, testDataSetNormalized)
err = testDataSetNormalized$sales-predictTestNormalized
hist(err)
```


```{r}
predictTestNormalized = predict(salesNet, testDataSet)
err = testDataSet$sales-predictTest
hist(err)
```